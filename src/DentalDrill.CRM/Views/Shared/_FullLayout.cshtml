@using DentalDrill.CRM.Services.Theming
@using DevGuild.AspNetCore.Services.Bundling.TagHelpers
@using Kendo.Mvc.TagHelpers
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using DentalDrill.CRM.Models.Permissions
@inject DentalDrill.CRM.Services.UserEntityResolver UserResolver
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>@ViewData["Title"] - Dental Drill Solutions</title>
    <environment include="Production">
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177303649-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-177303649-1');
        </script>
    </environment>

    <link rel="icon" type="image/png" sizes="32x32" href="/icon/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icon/favicon-16.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/icon/favicon-48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon/favicon-192.png">
    <link rel="apple-touch-icon" type="image/png" sizes="167x167" href="/icon/favicon-167.png">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/icon/favicon-180.png">
    <link rel="shortcut icon" href="/icon/favicon.ico">

    @inject IThemesService Theme

    <styles-bundle path="/vendor/vendor.min.css" />
    <styles-bundle path="@await Theme.ResolveResourcePath("/vendor/kendo/kendo.min.css")" />
    <styles-bundle path="/vendor/internal.min.css" />
    <styles-bundle path="@await Theme.ResolveResourcePath("/css/main.min.css")" />
    @await Theme.RenderCustomStyles()

    <scripts-bundle path="/vendor/vendor.min.js" />
    <scripts-bundle path="/vendor/kendo/kendo.min.js" />
    <scripts-bundle path="/js/app/routing.min.js" />
</head>
<body>
    <header>
        @if (User.Identity.IsAuthenticated && User.IsInRole(ApplicationRoles.Client))
        {
            @await Component.InvokeAsync("SurgeryHeader")
        }
        else
        {
            <nav class="navbar navbar--slim navbar-expand-md navbar-light fixed-top bg-m-dark">
                <div class="container">
                    <a asp-area="" asp-controller="Home" asp-action="Index" class="navbar-brand">
                        <img src="@await Theme.ResolveResourcePath("/img/hub-logo.png")" class="d-inline-block align-top" alt="Dental Drill Solutions">
                    </a>
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-items" aria-controls="navbar-items">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="navbar-collapse collapse" id="navbar-items">
                        <ul class="navbar-nav mr-auto">
                            @if (User.Identity.IsAuthenticated)
                            {
                                var userAccess = await this.UserResolver.GetEmployeeAccessAsync();
                                var isCorporate = User.IsInRole(ApplicationRoles.Corporate);
                                var isClient = User.IsInRole(ApplicationRoles.Client);

                                @*Office*@
                                if (userAccess.CanAccessClients())
                                {
                                    <li class="nav-item btn btn-outline-info"><a class="nav-link" asp-controller="Clients" asp-action="Index"><i class="fas fa-headset"></i> Office</a></li>
                                }

                                @*Workshop*@
                                if (userAccess.CanAccessWorkshops())
                                {
                                    <li class="nav-item btn btn-outline-info"><a class="nav-link" asp-controller="Jobs" asp-action="Index"><i class="fas fa-wrench"></i> Workshop</a></li>
                                }

                                @*Inventory*@
                                if (userAccess.CanAccessInventory())
                                {
                                    <li class="nav-item btn btn-outline-info dropdown">
                                        <a class="nav-link dropdown-toggle" href="#" id="navbar-inventory" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-cubes"></i> Inventory
                                        </a>
                                        <div class="dropdown-menu" aria-labeledby="navbar-inventory">
                                            @if (userAccess.Inventory.HasPermission(InventoryPermissions.SKURead))
                                            {
                                                <a class="dropdown-item" asp-controller="Inventory" asp-action="Index">Inventory Stock</a>
                                            }

                                            @if (userAccess.Workshops.GetInventoryAvailable().Count > 0)
                                            {
                                                <a class="dropdown-item" asp-controller="InventoryMovements" asp-action="Index">Inventory Dashboard</a>
                                            }

                                            @if (userAccess.Inventory.HasPermission(InventoryPermissions.LegacyStockControl))
                                            {
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item" asp-controller="Stock" asp-action="Index">Stock Control (Legacy)</a>
                                            }
                                        </div>
                                    </li>
                                }

                                @*Directory - Special case to replace More*@
                                if (userAccess.Global.CanReadExact(GlobalComponent.HandpiecesDirectory))
                                {
                                    <li class="nav-item btn btn-outline-info"><a class="nav-link" asp-controller="HandpieceBrands" asp-action="Index"><i class="fas fa-database"></i> Directory</a></li>
                                }
                                @*Settings*@
                                else if (userAccess.Global.CanReadAny())
                                {
                                    <li class="nav-item btn btn-outline-info dropdown">
                                        <a class="nav-link dropdown-toggle" href="#" id="navbar-manage" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-th-large"></i> More
                                        </a>
                                        <div class="dropdown-menu" aria-labeledby="navbar-manage">
                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.User))
                                            {
                                                <a class="dropdown-item" asp-controller="Users" asp-action="Index">Users</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.Employee))
                                            {
                                                <a class="dropdown-item" asp-controller="Employees" asp-action="Index">Employees</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.Workshop))
                                            {
                                                <a class="dropdown-item" asp-controller="Workshops" asp-action="Index">Workshops</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.EmployeeRole))
                                            {
                                                <div class="dropdown-item dropdown-submenu dropright">
                                                    <a href="#" class="dropdown-toggle">Roles</a>
                                                    <div class="dropdown-menu">
                                                        <a class="dropdown-item" asp-controller="EmployeeRoles" asp-action="Index">Employee Roles</a>
                                                        <a class="dropdown-item" asp-controller="WorkshopRoles" asp-action="Index">Workshop Roles</a>
                                                    </div>
                                                </div>
                                            }

                                            @if (userAccess.Global.CanReadAnyOf(GlobalComponent.User, GlobalComponent.Employee, GlobalComponent.Workshop, GlobalComponent.EmployeeRole) &&
                                           userAccess.Global.CanReadAnyOf(GlobalComponent.Corporate, GlobalComponent.PickupRequest, GlobalComponent.CorporatePricing, GlobalComponent.Feedback))
                                            {
                                                <div class="dropdown-divider"></div>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.Corporate))
                                            {
                                                <a class="dropdown-item" asp-controller="Corporates" asp-action="Index">Corporates</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.PickupRequest))
                                            {
                                                <a class="dropdown-item" asp-controller="PickupRequests" asp-action="Index">Pickup Requests</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.CorporatePricing))
                                            {
                                                <a class="dropdown-item" asp-controller="CorporatePricingServiceLevels" asp-action="Index">Corporate Pricing</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.Feedback))
                                            {
                                                <a class="dropdown-item" asp-controller="FeedbackForms" asp-action="Index">Feedback</a>
                                            }

                                            @if (userAccess.Global.CanReadAnyOf(GlobalComponent.Report))
                                            {
                                                <div class="dropdown-divider"></div>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.Report))
                                            {
                                                <a class="dropdown-item" asp-controller="Reports" asp-action="Index">DDS Reports</a>
                                            }

                                            @if (userAccess.Global.CanReadAnyOf(GlobalComponent.EmailTemplate, GlobalComponent.EmailReminder))
                                            {
                                                <div class="dropdown-divider"></div>
                                            }

                                            @if (userAccess.Global.CanReadAnyOf(GlobalComponent.EmailTemplate, GlobalComponent.EmailReminder))
                                            {
                                                <div class="dropdown-item dropdown-submenu dropright">
                                                    <a href="#" class="dropdown-toggle">Email</a>
                                                    <div class="dropdown-menu">
                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.EmailTemplate))
                                                        {
                                                            <a class="dropdown-item" asp-controller="EmailTemplates" asp-action="Index">Templates</a>
                                                        }

                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.EmailReminder))
                                                        {
                                                            <a class="dropdown-item" asp-controller="MaintenanceReminder" asp-action="Index">Maintenance Reminder</a>
                                                        }
                                                    </div>
                                                </div>
                                            }

                                            @if (userAccess.Global.CanReadAnyOf(GlobalComponent.HandpiecesDirectory, GlobalComponent.HandpiecesStore, GlobalComponent.HandpiecesOrder, GlobalComponent.State, GlobalComponent.Zone, GlobalComponent.DiagnosticChecklist, GlobalComponent.ProblemOption, GlobalComponent.ReturnEstimate, GlobalComponent.ServiceLevel))
                                            {
                                                <div class="dropdown-divider"></div>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.HandpiecesDirectory))
                                            {
                                                <a class="dropdown-item" asp-controller="HandpieceBrands" asp-action="Index">Handpieces Directory</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.HandpiecesStore))
                                            {
                                                <a class="dropdown-item" asp-controller="HandpieceStore" asp-action="Index">Handpieces Store</a>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.HandpiecesOrder))
                                            {
                                                <a class="dropdown-item" asp-controller="HandpieceStoreOrders" asp-action="Index">Handpieces Orders</a>
                                            }

                                            @if (userAccess.Global.CanReadAnyOf(GlobalComponent.State, GlobalComponent.Zone, GlobalComponent.DiagnosticChecklist, GlobalComponent.ProblemOption, GlobalComponent.ReturnEstimate, GlobalComponent.ServiceLevel))
                                            {
                                                <div class="dropdown-item dropdown-submenu dropright">
                                                    <a href="#" class="dropdown-toggle">Other Directories</a>
                                                    <div class="dropdown-menu">
                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.State))
                                                        {
                                                            <a class="dropdown-item" asp-controller="States" asp-action="Index">States</a>
                                                        }

                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.Zone))
                                                        {
                                                            <a class="dropdown-item" asp-controller="Zones" asp-action="Index">Zones</a>
                                                        }

                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.DiagnosticChecklist))
                                                        {
                                                            <a class="dropdown-item" asp-controller="DiagnosticCheckItems" asp-action="Index">Diagnostic checklist</a>
                                                            <a class="dropdown-item" asp-controller="DiagnosticCheckTypes" asp-action="Index">Diagnostic types</a>
                                                        }

                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.ProblemOption))
                                                        {
                                                            <a class="dropdown-item" asp-controller="ProblemDescriptionOptions" asp-action="Index">Problem options</a>
                                                        }

                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.ReturnEstimate))
                                                        {
                                                            <a class="dropdown-item" asp-controller="ReturnEstimates" asp-action="Index">Return estimates</a>
                                                        }

                                                        @if (userAccess.Global.CanReadComponent(GlobalComponent.ServiceLevel))
                                                        {
                                                            <a class="dropdown-item" asp-controller="ServiceLevels" asp-action="Index">Service Levels</a>
                                                        }
                                                    </div>
                                                </div>
                                            }

                                            @if (userAccess.Global.CanReadAnyOf(GlobalComponent.Tutorial))
                                            {
                                                <div class="dropdown-divider"></div>
                                            }

                                            @if (userAccess.Global.CanReadComponent(GlobalComponent.Tutorial))
                                            {
                                                <a class="dropdown-item" asp-controller="Home" asp-action="HubTutorial">Hub Tutorials</a>
                                                <a class="dropdown-item" asp-controller="Home" asp-action="SurgeryTutorials">Surgery Tutorials</a>
                                                <div class="dropdown-item dropdown-submenu dropright">
                                                    <a href="#" class="dropdown-toggle">Manage Tutorials</a>
                                                    <div class="dropdown-menu">
                                                        <a class="dropdown-item" asp-controller="TutorialVideos" asp-action="Index" asp-route-parentId="Hub">Hub Tutorials</a>
                                                        <a class="dropdown-item" asp-controller="TutorialVideos" asp-action="Index" asp-route-parentId="Surgery">Surgery Tutorials</a>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </li>
                                }

                                @*Clients and Corporates*@
                                if (isClient || isCorporate)
                                {
                                    <li class="nav-item btn btn-outline-info"><a class="nav-link" asp-controller="Home" asp-action="HubTutorial"><i class="fas fa-book"></i> Hub tutorial</a></li>
                                    <li class="nav-item btn btn-outline-info"><a class="nav-link" asp-controller="Home" asp-action="SurgeryTutorials"><i class="fas fa-screwdriver"></i> Tech tips</a></li>
                                    <li class="nav-item btn btn-outline-info"><a class="nav-link" asp-controller="Pickup" asp-action="Index"><i class="fas fa-shipping-fast"></i> Book a Pick-up</a></li>
                                    <li class="nav-item btn btn-outline-info"><a class="nav-link" asp-controller="HandpieceStore" asp-action="Index"><i class="fas fa-shopping-cart"></i> Handpiece Store</a></li>
                                }
                            }
                        </ul>
                        @await Html.PartialAsync("_LoginPartial")
                    </div>
                </div>
            </nav>
        }
    </header>

    <main role="main" class="main main--slim">
        <div class="container-fluid">
            @RenderBody()
        </div>
    </main>
    <partial name="_FooterSlimPartial" />
    <scripts-bundle path="/vendor/internal.min.js" />
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
