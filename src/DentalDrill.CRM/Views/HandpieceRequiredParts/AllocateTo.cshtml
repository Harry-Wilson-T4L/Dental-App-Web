@using DevGuild.AspNetCore.Controls.HybridForms
@using DentalDrill.CRM.Extensions
@using Newtonsoft.Json
@model DentalDrill.CRM.Models.ViewModels.HandpieceRequiredParts.HandpieceRequiredPartAllocateToModel
@{
    ViewBag.Title = "Swap";
    this.ConfigureHybridPage("HandpieceRequiredPartsAllocateTo");
}

<div class="editor" id="HandpieceRequiredPartsAllocateToEditor">
    @if (!this.Context.IsAjaxRequest())
    {
        <div class="editor__header">
            <div class="editor__title">
                <h1>Swap</h1>
            </div>
            <div class="editor__actions">
                <a asp-action="Edit" asp-controller="Handpieces" asp-route-id="@Model.Handpiece.Id" class="editor__action"><span class="fas fa-list"></span> List</a>
            </div>
        </div>
    }

    <form asp-action="AllocateTo" asp-route-handpiece="@Model.Handpiece.Id" asp-route-sku="@Model.SKU.Id"
          hybrid-form-id="HandpieceRequiredPartsAllocateTo"
          id="HandpieceRequiredPartsAllocateToForm">
        <div asp-validation-summary="ModelOnly"></div>

        <div class="row">
            <div class="col-12 mb-2">
                <div class="row">
                    <div class="col-3">
                        <label class="col-form-label">SKU</label>
                    </div>
                    <div class="col-9">
                        <p class="form-control-plaintext">[@Model.SKU.Type.Name] @Model.SKU.Name</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 mb-2">
                <div class="row">
                    <div class="col-6">
                        <label class="col-form-label">Required QTY</label>
                    </div>
                    <div class="col-6">
                        <p class="form-control-plaintext">@Model.RequiredQuantity.ToString("#,##0.##")</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 mb-2">
                <div class="row">
                    <div class="col-6">
                        <label class="col-form-label">Shelf QTY</label>
                    </div>
                    <div class="col-6">
                        <p class="form-control-plaintext">@Model.ShelfQuantity.ToString("#,##0.##")</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 mb-2">
                <div class="row editor__field" data-field="MoveFromHandpieces">
                    <div class="col-6">
                        <label class="col-form-label">Move from handpieces</label>
                    </div>
                    <div class="col-6">
                        <p class="editor__field__value form-control-plaintext">0</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 mb-2">
                <div class="row editor__field" data-field="MoveFromShelf">
                    <div class="col-6">
                        <label class="col-form-label">Move from shelf</label>
                    </div>
                    <div class="col-6">
                        <p class="editor__field__value form-control-plaintext @(Model.RequiredQuantity > Model.ShelfQuantity ? "text-danger" : "")">@Model.RequiredQuantity.ToString("#,##0.##")</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col mb-2 grid-container">
            </div>
        </div>

        <div class="d-none editor__data">
        </div>

        <div class="row">
            <div class="col editor__submit">
                <button type="submit" class="btn btn-primary" disabled="@(Model.RequiredQuantity > Model.ShelfQuantity ? "disabled" : null)">Swap</button>
                <a asp-action="Edit" asp-controller="Handpieces" asp-route-id="@Model.Handpiece.Id" class="btn btn-outline-secondary ml-2 editor__submit__cancel">Cancel</a>
            </div>
        </div>
    </form>
    <script type="text/javascript">
        $(function () {
            var ns = DentalDrill.CRM.Pages.HandpieceRequiredParts.AllocateTo;
            var options = new ns.AllocateToOptions();
            options.handpieceId = @Html.Raw(JsonConvert.SerializeObject(Model.Handpiece.Id));
            options.skuId = @Html.Raw(JsonConvert.SerializeObject(Model.SKU.Id));
            options.requiredQuantity = @Html.Raw(JsonConvert.SerializeObject(Model.RequiredQuantity));
            options.shelfQuantity = @Html.Raw(JsonConvert.SerializeObject(Model.ShelfQuantity));

            var editorRoot = document.getElementById("HandpieceRequiredPartsAllocateToEditor");
            var editor = new ns.AllocateToEditor(editorRoot, options);
            editor.init();
        });
    </script>
</div>

@section Scripts
{
    <script type="text/javascript" src="~/js/app/pages/handpieceRequiredParts/allocateTo.js" asp-append-version="true"></script>
} 