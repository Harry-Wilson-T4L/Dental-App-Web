//# sourceMappingURL=ReportSurgeryItem.js.map
//# sourceMappingURL=HandpieceBrandPieItem.js.map
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var DentalDrill;
(function (DentalDrill) {
    var CRM;
    (function (CRM) {
        var Pages;
        (function (Pages) {
            var Surgeries;
            (function (Surgeries) {
                var Reports;
                (function (Reports) {
                    var ChartBase = /** @class */ (function () {
                        function ChartBase(collection) {
                            this._collection = collection;
                            var _a = this.createHost(), host = _a.host, container = _a.container;
                            this._host = host;
                            this._container = container;
                        }
                        Object.defineProperty(ChartBase.prototype, "collection", {
                            get: function () {
                                return this._collection;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ChartBase.prototype, "host", {
                            get: function () {
                                return this._host;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        ChartBase.prototype.createHost = function () {
                            var host = $("<div></div>")
                                .addClass("chart__host");
                            var container = $("<div></div>")
                                .addClass("chart")
                                .addClass("chart__container")
                                .append(host);
                            this.afterHostCreated(host, container);
                            this._collection.container.append(container);
                            return { host: host, container: container };
                        };
                        ChartBase.prototype.afterHostCreated = function (host, container) {
                        };
                        return ChartBase;
                    }());
                    Reports.ChartBase = ChartBase;
                    var PieChart = /** @class */ (function (_super) {
                        __extends(PieChart, _super);
                        function PieChart(container) {
                            return _super.call(this, container) || this;
                        }
                        PieChart.prototype.initialize = function (title, data, format, template, maxValue) {
                            this.host.kendoChart({
                                title: {
                                    position: "bottom",
                                    text: title,
                                    font: "italic 1rem sans-serif",
                                    margin: {
                                        top: -30
                                    }
                                },
                                legend: {
                                    visible: false
                                },
                                chartArea: {
                                    background: ""
                                },
                                seriesDefaults: {
                                    labels: {
                                        visible: true,
                                        background: "transparent",
                                        template: template,
                                        format: format
                                    }
                                },
                                seriesColors: [
                                    "#0c81c5", "#c5dceb", "#3aa2de", "#d8ecf8", "#1f6aa3", "#054158"
                                ],
                                series: [
                                    {
                                        type: "pie",
                                        startAngle: 150,
                                        data: data
                                    }
                                ],
                                tooltip: {
                                    visible: true,
                                    format: format
                                }
                            });
                        };
                        PieChart.prototype.afterHostCreated = function (host, container) {
                            container.addClass("col-12 col-md-6 mt-3");
                        };
                        return PieChart;
                    }(ChartBase));
                    Reports.PieChart = PieChart;
                    var BarChart = /** @class */ (function (_super) {
                        __extends(BarChart, _super);
                        function BarChart(container) {
                            return _super.call(this, container) || this;
                        }
                        BarChart.prototype.initialize = function (title, data, format, template, maxValue) {
                            this.host.kendoChart({
                                renderAs: "canvas",
                                title: {
                                    position: "bottom",
                                    text: title,
                                    font: "italic 1rem sans-serif"
                                },
                                legend: {
                                    visible: false
                                },
                                seriesDefaults: {
                                    type: "column",
                                    labels: {
                                        visible: true,
                                        background: "transparent",
                                        template: template,
                                        format: format
                                    }
                                },
                                series: [
                                    {
                                        name: "Average Rating",
                                        data: data.map(function (u) { return u.value; }),
                                        color: "#4682b4"
                                    }
                                ],
                                pannable: {
                                    lock: "y"
                                },
                                zoomable: {
                                    mousewheel: {
                                        lock: "y"
                                    },
                                    selection: {
                                        lock: "y"
                                    }
                                },
                                valueAxis: [
                                    {
                                        labels: {
                                            format: format
                                        },
                                        line: {
                                            visible: false
                                        }
                                    }
                                ],
                                categoryAxis: [
                                    {
                                        categories: data.map(function (u) { return u.name; }),
                                        labels: {
                                            rotation: "auto"
                                        },
                                        line: {
                                            visible: false
                                        }
                                    }
                                ],
                                tooltip: {
                                    visible: true,
                                    format: format
                                }
                            });
                        };
                        BarChart.prototype.afterHostCreated = function (host, container) {
                            container.addClass("col-12 col-md-6 mt-3");
                        };
                        return BarChart;
                    }(ChartBase));
                    Reports.BarChart = BarChart;
                    var LimitedBarChart = /** @class */ (function (_super) {
                        __extends(LimitedBarChart, _super);
                        function LimitedBarChart(container) {
                            return _super.call(this, container) || this;
                        }
                        LimitedBarChart.prototype.initialize = function (title, data, format, template, maxValue) {
                            this.host.kendoChart({
                                renderAs: "canvas",
                                title: {
                                    position: "bottom",
                                    text: title,
                                    font: "italic 1rem sans-serif"
                                },
                                legend: {
                                    visible: false
                                },
                                seriesDefaults: {
                                    type: "column",
                                    labels: {
                                        visible: true,
                                        background: "transparent",
                                        template: template,
                                        format: format
                                    }
                                },
                                series: [
                                    {
                                        name: "Average Rating",
                                        data: data.map(function (u) { return u.value; }),
                                        color: "#4682b4"
                                    }
                                ],
                                pannable: {
                                    lock: "y"
                                },
                                zoomable: {
                                    mousewheel: {
                                        lock: "y"
                                    },
                                    selection: {
                                        lock: "y"
                                    }
                                },
                                valueAxis: [
                                    {
                                        min: 0,
                                        max: maxValue,
                                        labels: {
                                            format: format
                                        },
                                        line: {
                                            visible: false
                                        }
                                    }
                                ],
                                categoryAxis: [
                                    {
                                        categories: data.map(function (u) { return u.name; }),
                                        labels: {
                                            rotation: "auto"
                                        },
                                        line: {
                                            visible: false
                                        }
                                    }
                                ],
                                tooltip: {
                                    visible: true,
                                    format: format
                                }
                            });
                        };
                        LimitedBarChart.prototype.afterHostCreated = function (host, container) {
                            container.addClass("col-12 col-md-6 mt-3");
                        };
                        return LimitedBarChart;
                    }(ChartBase));
                    Reports.LimitedBarChart = LimitedBarChart;
                    var TreeMapChart = /** @class */ (function (_super) {
                        __extends(TreeMapChart, _super);
                        function TreeMapChart(container) {
                            return _super.call(this, container) || this;
                        }
                        TreeMapChart.prototype.initialize = function (title, data, format, template, maxValue) {
                            this.host.kendoTreeMap({
                                dataSource: {
                                    data: [
                                        {
                                            name: title,
                                            items: data
                                        }
                                    ],
                                    schema: {
                                        model: {
                                            children: "items"
                                        }
                                    }
                                },
                                valueField: "value",
                                textField: "name",
                                colors: [
                                    ["#0c81c5", "#c5dceb"], ["#3aa2de", "#d8ecf8"],
                                    ["#449000", "#dae9cc"], ["#76b800", "#dae7c3"],
                                    ["#ffae00", "#f5e5c3"], ["#ef4c00", "#f1b092"],
                                    ["#9e0a61", "#eccedf"]
                                ]
                            });
                            var treeMap = this.host.data("kendoTreeMap");
                            this.host.kendoTooltip({
                                filter: ".k-leaf,.k-treemap-title",
                                position: "top",
                                content: function (e) {
                                    var item = treeMap.dataItem(e.target.closest(".k-treemap-tile"));
                                    return item.name;
                                }
                            });
                        };
                        TreeMapChart.prototype.afterHostCreated = function (host, container) {
                            container.addClass("col-12 mt-3");
                        };
                        return TreeMapChart;
                    }(ChartBase));
                    Reports.TreeMapChart = TreeMapChart;
                    var WaterfallChart = /** @class */ (function (_super) {
                        __extends(WaterfallChart, _super);
                        function WaterfallChart(container) {
                            return _super.call(this, container) || this;
                        }
                        WaterfallChart.prototype.initialize = function (title, data, format, template, maxValue) {
                            this.host.kendoChart({
                                renderAs: "canvas",
                                title: {
                                    position: "bottom",
                                    text: title,
                                    font: "italic 1rem sans-serif"
                                },
                                dataSource: {
                                    data: data
                                },
                                legend: {
                                    visible: false
                                },
                                seriesDefaults: {
                                    type: "column",
                                    labels: {
                                        visible: true,
                                        background: "transparent",
                                        template: template,
                                        format: format
                                    }
                                },
                                series: [
                                    {
                                        type: "horizontalWaterfall",
                                        field: "value",
                                        categoryField: "name",
                                        color: "#4682b4"
                                    }
                                ],
                                axisDefaults: {
                                    majorGridLines: {
                                        visible: false,
                                    }
                                },
                                pannable: {
                                    lock: "y"
                                },
                                zoomable: {
                                    mousewheel: {
                                        lock: "y"
                                    },
                                    selection: {
                                        lock: "y"
                                    }
                                },
                            });
                        };
                        WaterfallChart.prototype.afterHostCreated = function (host, container) {
                            container.addClass("col-12 col-md-6 mt-3");
                        };
                        return WaterfallChart;
                    }(ChartBase));
                    Reports.WaterfallChart = WaterfallChart;
                    var ChartsCollectionContainer = /** @class */ (function () {
                        function ChartsCollectionContainer(container) {
                            this._charts = [];
                            this._container = container;
                        }
                        Object.defineProperty(ChartsCollectionContainer.prototype, "container", {
                            get: function () {
                                return this._container;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ChartsCollectionContainer.prototype, "charts", {
                            get: function () {
                                return this._charts;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        ChartsCollectionContainer.prototype.createPieChart = function () {
                            var chart = new PieChart(this);
                            this._charts.push(chart);
                            return chart;
                        };
                        ChartsCollectionContainer.prototype.createBarChart = function () {
                            var chart = new BarChart(this);
                            this._charts.push(chart);
                            return chart;
                        };
                        ChartsCollectionContainer.prototype.createLimitedBarChart = function () {
                            var chart = new LimitedBarChart(this);
                            this._charts.push(chart);
                            return chart;
                        };
                        ChartsCollectionContainer.prototype.createTreeMap = function () {
                            var chart = new TreeMapChart(this);
                            this._charts.push(chart);
                            return chart;
                        };
                        ChartsCollectionContainer.prototype.createWaterfallChart = function () {
                            var chart = new WaterfallChart(this);
                            this._charts.push(chart);
                            return chart;
                        };
                        return ChartsCollectionContainer;
                    }());
                    Reports.ChartsCollectionContainer = ChartsCollectionContainer;
                    var TotalsCollectionContainer = /** @class */ (function () {
                        function TotalsCollectionContainer(container) {
                            this._container = container;
                        }
                        Object.defineProperty(TotalsCollectionContainer.prototype, "container", {
                            get: function () {
                                return this._container;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        TotalsCollectionContainer.prototype.addValue = function (key, value) {
                            var valueColValue = $("<div></div>")
                                .addClass("reports__insights__total__value")
                                .text(value);
                            var valueColKey = $("<div></div>")
                                .addClass("reports__insights__total__key")
                                .text(key);
                            var valueCol = $("<div></div>")
                                .addClass("col")
                                .addClass("reports__insights__total")
                                .addClass("text-center")
                                .append(valueColValue)
                                .append(valueColKey);
                            this._container.append(valueCol);
                        };
                        return TotalsCollectionContainer;
                    }());
                    Reports.TotalsCollectionContainer = TotalsCollectionContainer;
                })(Reports = Surgeries.Reports || (Surgeries.Reports = {}));
            })(Surgeries = Pages.Surgeries || (Pages.Surgeries = {}));
        })(Pages = CRM.Pages || (CRM.Pages = {}));
    })(CRM = DentalDrill.CRM || (DentalDrill.CRM = {}));
})(DentalDrill || (DentalDrill = {}));
//# sourceMappingURL=ChartBase.js.map
var DentalDrill;
(function (DentalDrill) {
    var CRM;
    (function (CRM) {
        var Pages;
        (function (Pages) {
            var Surgeries;
            (function (Surgeries) {
                var Reports;
                (function (Reports) {
                    var DateRangeSelector = DentalDrill.CRM.Controls.DateRangeSelector;
                    var ReportsPageMainControls = /** @class */ (function () {
                        function ReportsPageMainControls(root) {
                            this._dateRangeSelector = new DateRangeSelector(root.find(".reports__dates-range"));
                            this._dateFrom = root.find("input.reports__dates-from").data("kendoDatePicker");
                            this._dateTo = root.find("input.reports__dates-to").data("kendoDatePicker");
                            this._buttonClear = root.find(".reports__clear");
                            this._buttonSearch = root.find(".reports__search");
                            this._buttonCompare = root.find(".reports__compare");
                        }
                        Object.defineProperty(ReportsPageMainControls.prototype, "dateRangeSelector", {
                            get: function () {
                                return this._dateRangeSelector;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ReportsPageMainControls.prototype, "dateFrom", {
                            get: function () {
                                return this._dateFrom;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ReportsPageMainControls.prototype, "dateTo", {
                            get: function () {
                                return this._dateTo;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ReportsPageMainControls.prototype, "buttonClear", {
                            get: function () {
                                return this._buttonClear;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ReportsPageMainControls.prototype, "buttonSearch", {
                            get: function () {
                                return this._buttonSearch;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ReportsPageMainControls.prototype, "buttonCompare", {
                            get: function () {
                                return this._buttonCompare;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        return ReportsPageMainControls;
                    }());
                    Reports.ReportsPageMainControls = ReportsPageMainControls;
                })(Reports = Surgeries.Reports || (Surgeries.Reports = {}));
            })(Surgeries = Pages.Surgeries || (Pages.Surgeries = {}));
        })(Pages = CRM.Pages || (CRM.Pages = {}));
    })(CRM = DentalDrill.CRM || (DentalDrill.CRM = {}));
})(DentalDrill || (DentalDrill = {}));
//# sourceMappingURL=ReportsPageMainControls.js.map
var DentalDrill;
(function (DentalDrill) {
    var CRM;
    (function (CRM) {
        var Pages;
        (function (Pages) {
            var Surgeries;
            (function (Surgeries) {
                var Reports;
                (function (Reports) {
                    var ReportsTabBase = /** @class */ (function () {
                        function ReportsTabBase() {
                        }
                        ReportsTabBase.prototype.generateDateRange = function (from, to, type) {
                            function addMonth(date, numberOfMonths) {
                                var copy = new Date(date.getTime());
                                copy.setMonth(copy.getMonth() + numberOfMonths);
                                return copy;
                            }
                            function getWeekStart(date) {
                                var copy = new Date(date.getTime());
                                copy.setDate(copy.getDate() - copy.getDay());
                                return copy;
                            }
                            function getWeek(date) {
                                var jan1 = new Date(date.getFullYear(), 0, 1);
                                var jan1WeekStart = getWeekStart(jan1);
                                var dateWeekStart = getWeekStart(date);
                                var passedTime = dateWeekStart.getTime() - jan1WeekStart.getTime();
                                var passedWeeks = Math.floor(passedTime / (7 * 24 * 60 * 60 * 1000));
                                return passedWeeks + 1;
                            }
                            function addWeek(date, numberOfWeeks) {
                                var copy = new Date(date.getTime());
                                copy.setDate(copy.getDate() + 7 * numberOfWeeks);
                                return copy;
                            }
                            function addDay(date, numberOfDays) {
                                var copy = new Date(date.getTime());
                                copy.setDate(copy.getDate() + numberOfDays);
                                return copy;
                            }
                            function numPad(val, digits) {
                                var result = val.toString();
                                while (result.length < digits) {
                                    result = "0" + result;
                                }
                                return result;
                            }
                            switch (type) {
                                case "Yearly":
                                    {
                                        var start = from.getFullYear();
                                        var end = to.getFullYear();
                                        var result = [];
                                        for (var current = start; current <= end; current++) {
                                            result.push(current.toString());
                                        }
                                        return result;
                                    }
                                case "Quarterly":
                                    {
                                        var start = new Date(from.getFullYear(), Math.floor(from.getMonth() / 3) * 3, 1);
                                        var end = to;
                                        var result = [];
                                        for (var current = start; current <= end; current = addMonth(current, 3)) {
                                            result.push(current.getFullYear() + "-Q" + (Math.floor(current.getMonth() / 3) + 1));
                                        }
                                        return result;
                                    }
                                case "Monthly":
                                    {
                                        var start = new Date(from.getFullYear(), from.getMonth(), 1);
                                        var end = to;
                                        var result = [];
                                        for (var current = start; current <= end; current = addMonth(current, 1)) {
                                            result.push(current.getFullYear() + "-" + (current.getMonth() + 1));
                                        }
                                        return result;
                                    }
                                case "Weekly":
                                    {
                                        var start = getWeekStart(from);
                                        var end = to;
                                        var result = [];
                                        for (var current = start, week = getWeek(start), previous = current; current <= end; current = addWeek(current, 1), week++) {
                                            if (previous.getFullYear() !== current.getFullYear()) {
                                                week = 1;
                                                previous = current;
                                            }
                                            result.push(current.getFullYear() + "-W" + week);
                                        }
                                        return result;
                                    }
                                case "Daily":
                                    {
                                        var start = from;
                                        var end = to;
                                        var result = [];
                                        for (var current = start; current <= end; current = addDay(current, 1)) {
                                            result.push(current.getFullYear() + "-" + numPad(current.getMonth() + 1, 2) + "-" + numPad(current.getDate(), 2));
                                        }
                                        return result;
                                    }
                            }
                        };
                        return ReportsTabBase;
                    }());
                    Reports.ReportsTabBase = ReportsTabBase;
                })(Reports = Surgeries.Reports || (Surgeries.Reports = {}));
            })(Surgeries = Pages.Surgeries || (Pages.Surgeries = {}));
        })(Pages = CRM.Pages || (CRM.Pages = {}));
    })(CRM = DentalDrill.CRM || (DentalDrill.CRM = {}));
})(DentalDrill || (DentalDrill = {}));
//# sourceMappingURL=ReportsTabBase.js.map
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var DentalDrill;
(function (DentalDrill) {
    var CRM;
    (function (CRM) {
        var Pages;
        (function (Pages) {
            var Surgeries;
            (function (Surgeries) {
                var Reports;
                (function (Reports) {
                    var ToggleButton = DentalDrill.CRM.Controls.ToggleButton;
                    var ToggleList = DentalDrill.CRM.Controls.ToggleList;
                    var PdfReportBuilder = DentalDrill.CRM.Controls.PdfReports.PdfReportBuilder;
                    var ReportTable = DentalDrill.CRM.Controls.Reporting.ReportTable;
                    var SurgeryReportFlowWriter = DentalDrill.CRM.Controls.Reporting.SurgeryReportFlowWriter;
                    var ReportsTabBrands = /** @class */ (function (_super) {
                        __extends(ReportsTabBrands, _super);
                        function ReportsTabBrands(page, root) {
                            var _this = _super.call(this) || this;
                            _this._page = page;
                            _this._root = root;
                            _this._container = root.find(".reports__brands__container");
                            _this._insightsContainer = root.find(".reports__brands__insights-container");
                            _this._reportFields = new ToggleList(root.find(".reports__brands__fields"));
                            _this._reportFields.selectionChanged.subscribe(function (sender, e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.initialize()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            _this._dateAggregate = root.find("input.reports__brands__date-aggregate").data("kendoDropDownList");
                            _this._dateAggregate.bind("change", function (e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.initialize()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            _this._insightsToggle = new ToggleButton(root.find(".reports__brands__insights"));
                            _this._insightsToggle.changed.subscribe(function (sender, e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.toggleInsights()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            root.find(".reports__brands__export__excel").click(function (e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.exportExcel()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            root.find(".reports__brands__export__pdf").click(function (e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.exportPdf()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            return _this;
                        }
                        ReportsTabBrands.prototype.exportExcel = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    routes.surgeries.exportBrandsToExcel(this._page.clientUrlPath, this._filterDateFrom, this._filterDateTo, this._dateAggregate.value(), this._reportFields.selected.join(",")).open();
                                    return [2 /*return*/];
                                });
                            });
                        };
                        ReportsTabBrands.prototype.exportPdf = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                var formatAsNumber, formatAsPercent, reportBuilder, reportWriter, children, table, dateRanges, _loop_1, _i, dateRanges_1, dateRange, _loop_2, _a, dateRanges_2, dateRange, _loop_3, _b, dateRanges_3, dateRange, _loop_4, _c, dateRanges_4, dateRange, _loop_5, _d, dateRanges_5, dateRange, detailRows, dataSet, models, dataSet;
                                return __generator(this, function (_e) {
                                    formatAsNumber = function (x, decimalDigits) {
                                        if (typeof x === "number") {
                                            return x.toFixed(decimalDigits);
                                        }
                                        return "";
                                    };
                                    formatAsPercent = function (x, decimalDigits) {
                                        if (typeof x === "number") {
                                            return (x * 100).toFixed(decimalDigits) + "%";
                                        }
                                        return "";
                                    };
                                    reportBuilder = new PdfReportBuilder();
                                    reportBuilder.fileName = this._page.clientUrlPath + "-ByBrand.pdf";
                                    reportBuilder.open();
                                    reportWriter = new SurgeryReportFlowWriter(reportBuilder);
                                    reportWriter.addHeading(1, "Handpieces by brands");
                                    if (this._insightsToggle.active) {
                                        children = this._insightsContainer.children();
                                        reportWriter.addInsightsTotals(undefined, $(children[0]));
                                        reportWriter.addCharts($(children[1]).find(".k-chart").toArray().map(function (element, index) { return $(element).data("kendoChart"); }));
                                    }
                                    table = new ReportTable();
                                    table.rowHeight = 23;
                                    table.addColumn("Brand", 200, function (x) { return x.Brand; });
                                    if (this._dateAggregate.value() === "EntirePeriod") {
                                        if (this._reportFields.isToggled("RatingAverage")) {
                                            table.addColumn("Avg. Rating", 50, function (x) { return formatAsNumber(x.RatingAverage, 2); });
                                        }
                                        if (this._reportFields.isToggled("UnrepairedPercent")) {
                                            table.addColumn("% Unrep.", 50, function (x) { return formatAsPercent(x.UnrepairedPercent, 2); });
                                        }
                                        if (this._reportFields.isToggled("CostSum")) {
                                            table.addColumn("Cost", 50, function (x) { return formatAsNumber(x.CostSum, 2); });
                                        }
                                        if (this._reportFields.isToggled("CostAverage")) {
                                            table.addColumn("Avg. Cost", 50, function (x) { return formatAsNumber(x.CostAverage, 2); });
                                        }
                                        if (this._reportFields.isToggled("HandpiecesCount")) {
                                            table.addColumn("# HPs", 50, function (x) { return formatAsNumber(x.HandpiecesCount, 0); });
                                        }
                                    }
                                    else {
                                        dateRanges = this.generateDateRange(this._filterDateFrom, this._filterDateTo, this._dateAggregate.value());
                                        if (this._reportFields.isToggled("RatingAverage")) {
                                            _loop_1 = function (dateRange) {
                                                table.addColumn("" + dateRange, 50, function (x) { return formatAsNumber(x.RatingAverage[dateRange], 2); });
                                            };
                                            for (_i = 0, dateRanges_1 = dateRanges; _i < dateRanges_1.length; _i++) {
                                                dateRange = dateRanges_1[_i];
                                                _loop_1(dateRange);
                                            }
                                            table.groupLastColumns("Avg. Rating", dateRanges.length);
                                        }
                                        if (this._reportFields.isToggled("UnrepairedPercent")) {
                                            _loop_2 = function (dateRange) {
                                                table.addColumn("" + dateRange, 50, function (x) { return formatAsPercent(x.UnrepairedPercent[dateRange], 2); });
                                            };
                                            for (_a = 0, dateRanges_2 = dateRanges; _a < dateRanges_2.length; _a++) {
                                                dateRange = dateRanges_2[_a];
                                                _loop_2(dateRange);
                                            }
                                            table.groupLastColumns("% Unrep.", dateRanges.length);
                                        }
                                        if (this._reportFields.isToggled("CostSum")) {
                                            _loop_3 = function (dateRange) {
                                                table.addColumn("" + dateRange, 50, function (x) { return formatAsNumber(x.CostSum[dateRange], 2); });
                                            };
                                            for (_b = 0, dateRanges_3 = dateRanges; _b < dateRanges_3.length; _b++) {
                                                dateRange = dateRanges_3[_b];
                                                _loop_3(dateRange);
                                            }
                                            table.groupLastColumns("Cost", dateRanges.length);
                                        }
                                        if (this._reportFields.isToggled("CostAverage")) {
                                            _loop_4 = function (dateRange) {
                                                table.addColumn("" + dateRange, 50, function (x) { return formatAsNumber(x.CostAverage[dateRange], 2); });
                                            };
                                            for (_c = 0, dateRanges_4 = dateRanges; _c < dateRanges_4.length; _c++) {
                                                dateRange = dateRanges_4[_c];
                                                _loop_4(dateRange);
                                            }
                                            table.groupLastColumns("Avg. Cost", dateRanges.length);
                                        }
                                        if (this._reportFields.isToggled("HandpiecesCount")) {
                                            _loop_5 = function (dateRange) {
                                                table.addColumn("" + dateRange, 50, function (x) { return formatAsNumber(x.HandpiecesCount[dateRange], 0); });
                                            };
                                            for (_d = 0, dateRanges_5 = dateRanges; _d < dateRanges_5.length; _d++) {
                                                dateRange = dateRanges_5[_d];
                                                _loop_5(dateRange);
                                            }
                                            table.groupLastColumns("# HPs", dateRanges.length);
                                        }
                                    }
                                    detailRows = this._mainGrid.wrapper.find(".k-grid-content .k-detail-row:visible");
                                    if (detailRows.length > 0) {
                                        dataSet = this._dataSource.data().map(function (x) { return x; });
                                        models = this._dataSourceModels.data().map(function (x) { return x; });
                                        table.columns[0].setFormatter(function (item) {
                                            if (item.Model) {
                                                return item.Brand + " " + item.Model;
                                            }
                                            return item.Brand;
                                        });
                                        table.setData(dataSet.concat(models), function (left, right) {
                                            if (left.Brand < right.Brand)
                                                return -1;
                                            if (left.Brand > right.Brand)
                                                return 1;
                                            if (left.Model < right.Model)
                                                return -1;
                                            if (left.Model > right.Model)
                                                return 1;
                                            return 0;
                                        });
                                        table.dataRowFormatted.subscribe(function (sender, args) {
                                            if (!args.item.Model) {
                                                args.row.classList.add("report-table__row--parent");
                                            }
                                        });
                                    }
                                    else {
                                        dataSet = this._dataSource.data().map(function (x) { return x; });
                                        table.setData(dataSet, function (left, right) {
                                            if (left.Brand < right.Brand)
                                                return -1;
                                            if (left.Brand > right.Brand)
                                                return 1;
                                            return 0;
                                        });
                                    }
                                    reportWriter.addTable(table);
                                    return [2 /*return*/];
                                });
                            });
                        };
                        ReportsTabBrands.prototype.initializeDataSourceFields = function (fields) {
                            var dateAggregate = this._dateAggregate.value();
                            var baseFields = ["RatingAverage", "CostSum", "CostAverage", "UnrepairedPercent", "HandpiecesCount"];
                            if (dateAggregate === "EntirePeriod") {
                                for (var _i = 0, baseFields_1 = baseFields; _i < baseFields_1.length; _i++) {
                                    var field = baseFields_1[_i];
                                    fields[field] = { type: "number", from: field };
                                }
                            }
                            else {
                                var dateRanges = this.generateDateRange(this._filterDateFrom, this._filterDateTo, dateAggregate);
                                for (var _a = 0, baseFields_2 = baseFields; _a < baseFields_2.length; _a++) {
                                    var field = baseFields_2[_a];
                                    for (var _b = 0, dateRanges_6 = dateRanges; _b < dateRanges_6.length; _b++) {
                                        var range = dateRanges_6[_b];
                                        fields[field + "_" + range.replace("-", "_")] = { type: "number", from: field + "[\"" + range + "\"]" };
                                    }
                                }
                            }
                            return fields;
                        };
                        ReportsTabBrands.prototype.initializeDataSources = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0:
                                            this._dataSource = new kendo.data.DataSource({
                                                type: "aspnetmvc-ajax",
                                                transport: {
                                                    read: {
                                                        url: "/Surgeries/" + this._page.clientUrlPath + "/Reports/Brands",
                                                        data: {
                                                            From: this._filterDateFrom.toISOString(),
                                                            To: this._filterDateTo.toISOString(),
                                                            DateAggregate: this._dateAggregate.value()
                                                        }
                                                    }
                                                },
                                                schema: {
                                                    data: "Data",
                                                    total: "Total",
                                                    errors: "Errors",
                                                    model: {
                                                        fields: this.initializeDataSourceFields({
                                                            Brand: { type: "string" }
                                                        })
                                                    }
                                                }
                                            });
                                            return [4 /*yield*/, this._dataSource.read()];
                                        case 1:
                                            _a.sent();
                                            this._dataSourceModels = new kendo.data.DataSource({
                                                type: "aspnetmvc-ajax",
                                                transport: {
                                                    read: {
                                                        url: "/Surgeries/" + this._page.clientUrlPath + "/Reports/Brands/ByModel",
                                                        data: {
                                                            From: this._filterDateFrom.toISOString(),
                                                            To: this._filterDateTo.toISOString(),
                                                            DateAggregate: this._dateAggregate.value()
                                                        }
                                                    }
                                                },
                                                schema: {
                                                    data: "Data",
                                                    total: "Total",
                                                    errors: "Errors",
                                                    model: {
                                                        fields: this.initializeDataSourceFields({
                                                            Brand: { type: "string" },
                                                            Model: { type: "string" }
                                                        })
                                                    }
                                                }
                                            });
                                            return [4 /*yield*/, this._dataSourceModels.read()];
                                        case 2:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            });
                        };
                        ReportsTabBrands.prototype.getFieldsCandidates = function () {
                            return [
                                {
                                    field: "RatingAverage",
                                    title: "Avg. Rating",
                                    format: "{0:n}"
                                },
                                {
                                    field: "UnrepairedPercent",
                                    title: "% Unrep.",
                                    format: "{0:p2}"
                                },
                                {
                                    field: "CostSum",
                                    title: "Cost",
                                    format: "{0:c0}"
                                },
                                {
                                    field: "CostAverage",
                                    title: "Avg. Cost",
                                    format: "{0:c0}"
                                },
                                {
                                    field: "HandpiecesCount",
                                    title: "# HPs",
                                    format: "{0:n0}"
                                }
                            ];
                        };
                        ReportsTabBrands.prototype.createMainGrid = function () {
                            var _this = this;
                            var wrapper = $("<div></div>");
                            this._container.empty();
                            this._container.append(wrapper);
                            var columnsConfig = [];
                            columnsConfig.push({
                                field: "Brand",
                                title: "Brand",
                                width: "300px"
                            });
                            var selectedFields = this._reportFields.selected;
                            var fieldsCandidates = this.getFieldsCandidates();
                            var dateAggregate = this._dateAggregate.value();
                            for (var _i = 0, _a = fieldsCandidates.filter(function (x) { return selectedFields.indexOf(x.field) >= 0; }); _i < _a.length; _i++) {
                                var candidate = _a[_i];
                                if (dateAggregate === "EntirePeriod") {
                                    columnsConfig.push({
                                        field: candidate.field,
                                        title: candidate.title,
                                        width: "125px",
                                        format: candidate.format,
                                    });
                                }
                                else {
                                    var dateRanges = this.generateDateRange(this._filterDateFrom, this._filterDateTo, dateAggregate);
                                    var childColumns = [];
                                    for (var _b = 0, dateRanges_7 = dateRanges; _b < dateRanges_7.length; _b++) {
                                        var range = dateRanges_7[_b];
                                        childColumns.push({
                                            title: range,
                                            field: candidate.field + "_" + range.replace("-", "_"),
                                            width: "125px",
                                            format: candidate.format,
                                        });
                                    }
                                    columnsConfig.push({
                                        title: candidate.title,
                                        columns: childColumns
                                    });
                                }
                            }
                            columnsConfig.push({
                                title: ""
                            });
                            wrapper.kendoGrid({
                                dataSource: this._dataSource,
                                columns: columnsConfig,
                                scrollable: true,
                                sortable: {
                                    mode: "multiple",
                                    allowUnsort: true,
                                },
                                detailTemplate: function (data) {
                                    var html = "";
                                    html += "<div class=\"reports__brands__item__details\">";
                                    html += "  <ul>";
                                    html += "    <li class=\"k-state-active\">By Models</li>";
                                    html += "  </ul>";
                                    html += "  <div>";
                                    html += "    <div class=\"reports__brands__item__details__models-grid\"></div>";
                                    html += "  </div>";
                                    html += "</div>";
                                    return html;
                                },
                                noRecords: {
                                    template: "No data available for selected date range and surgeries"
                                },
                                detailInit: function (e) {
                                    var tabStripHost = e.detailCell.find(".reports__brands__item__details");
                                    tabStripHost.kendoTabStrip();
                                    var modelsGridHost = e.detailCell.find(".reports__brands__item__details__models-grid");
                                    var brand = e.data["Brand"];
                                    _this.createModelsGrid(modelsGridHost, brand);
                                }
                            });
                            this._mainGrid = wrapper.data("kendoGrid");
                        };
                        ReportsTabBrands.prototype.createModelsGrid = function (host, brand) {
                            var subset = [];
                            var superset = this._dataSourceModels.data();
                            for (var i = 0; i < superset.length; i++) {
                                var item = superset[i];
                                if (item["Brand"] === brand)
                                    subset.push({
                                        Brand: item["Brand"],
                                        Model: item["Model"],
                                        RatingAverage: item["RatingAverage"],
                                        CostSum: item["CostSum"],
                                        CostAverage: item["CostAverage"],
                                        HandpiecesCount: item["HandpiecesCount"],
                                        UnrepairedPercent: item["UnrepairedPercent"]
                                    });
                            }
                            var modelsDataSource = new kendo.data.DataSource({
                                data: subset,
                                schema: {
                                    model: {
                                        fields: this.initializeDataSourceFields({
                                            Brand: { type: "string" },
                                            Model: { type: "string" }
                                        })
                                    }
                                }
                            });
                            var modelsColumnsConfig = [];
                            modelsColumnsConfig.push({
                                field: "Model",
                                template: "#: Brand # #: Model #",
                                title: "Model",
                                width: "200px"
                            });
                            var selectedFields = this._reportFields.selected;
                            var fieldsCandidates = this.getFieldsCandidates();
                            var dateAggregate = this._dateAggregate.value();
                            for (var _i = 0, _a = fieldsCandidates.filter(function (x) { return selectedFields.indexOf(x.field) >= 0; }); _i < _a.length; _i++) {
                                var candidate = _a[_i];
                                if (dateAggregate === "EntirePeriod") {
                                    modelsColumnsConfig.push({
                                        field: candidate.field,
                                        title: candidate.title,
                                        width: "125px",
                                        format: candidate.format,
                                    });
                                }
                                else {
                                    var dateRanges = this.generateDateRange(this._filterDateFrom, this._filterDateTo, dateAggregate);
                                    var childColumns = [];
                                    for (var _b = 0, dateRanges_8 = dateRanges; _b < dateRanges_8.length; _b++) {
                                        var range = dateRanges_8[_b];
                                        childColumns.push({
                                            title: range,
                                            field: candidate.field + "_" + range.replace("-", "_"),
                                            width: "125px",
                                            format: candidate.format,
                                        });
                                    }
                                    modelsColumnsConfig.push({
                                        title: candidate.title,
                                        columns: childColumns
                                    });
                                }
                            }
                            modelsColumnsConfig.push({
                                title: ""
                            });
                            host.kendoGrid({
                                dataSource: modelsDataSource,
                                columns: modelsColumnsConfig,
                                scrollable: true,
                                sortable: {
                                    mode: "multiple",
                                    allowUnsort: true,
                                },
                            });
                        };
                        ReportsTabBrands.prototype.initialize = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.initializeDataSources()];
                                        case 1:
                                            _a.sent();
                                            this.createMainGrid();
                                            return [4 /*yield*/, this.toggleInsights()];
                                        case 2:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            });
                        };
                        ReportsTabBrands.prototype.applyGlobalFilters = function (from, to) {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    this._filterDateFrom = from;
                                    this._filterDateTo = to;
                                    return [2 /*return*/];
                                });
                            });
                        };
                        ReportsTabBrands.prototype.toggleInsights = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                /* General rendering */
                                function addValue(key, value) {
                                    var valueColValue = $("<div></div>")
                                        .addClass("reports__insights__total__value")
                                        .text(value);
                                    var valueColKey = $("<div></div>")
                                        .addClass("reports__insights__total__key")
                                        .text(key);
                                    var valueCol = $("<div></div>")
                                        .addClass("col")
                                        .addClass("reports__insights__total")
                                        .addClass("text-center")
                                        .append(valueColValue)
                                        .append(valueColKey);
                                    totalsWrapper.append(valueCol);
                                }
                                function renderNoRecords() {
                                    var noRecordsWrapper = $("<div></div>").addClass("row");
                                    var noRecordValue = $("<div></div>")
                                        .addClass("reports__insights__total__value")
                                        .addClass("col-12")
                                        .text("No data available for selected date range and surgeries")
                                        .appendTo(noRecordsWrapper);
                                    self._insightsContainer.append(noRecordsWrapper);
                                }
                                /* Flat Values */
                                function renderFlatValueInsights(totalCount, totalRating, totalUnrepaired, totalCost) {
                                    if (self._reportFields.isToggled("RatingAverage")) {
                                        addValue("Avg. rating", "" + kendo.toString(totalRating / totalCount, "n2"));
                                    }
                                    if (self._reportFields.isToggled("UnrepairedPercent")) {
                                        addValue("Unrepaired", "" + kendo.toString(totalUnrepaired / totalCount, "p2"));
                                    }
                                    if (self._reportFields.isToggled("CostSum")) {
                                        addValue("Total spent", "$" + kendo.toString(totalCost, "n0"));
                                    }
                                    if (self._reportFields.isToggled("CostAverage")) {
                                        addValue("Avg. spent", "$" + kendo.toString(totalCost / totalCount, "n0"));
                                    }
                                    if (self._reportFields.isToggled("HandpiecesCount")) {
                                        addValue("Handpieces", "" + totalCount);
                                    }
                                    self._insightsContainer.append(totalsWrapper);
                                }
                                function renderAggregatedCharts() {
                                    self._insightsContainer.append(chartsWrapper);
                                    var aggregatedBarData = self.calculateAggregatedChartData();
                                    if (self._reportFields.isToggled("RatingAverage")) {
                                        var barChartData = self.getAggregatedBarData(aggregatedBarData, "AverageRating");
                                        charts.createLimitedBarChart()
                                            .initialize("Average rating of handpieces by period", barChartData, "{0:n2}", "#= value ? value.toFixed(2) : '' #", 10);
                                    }
                                    if (self._reportFields.isToggled("UnrepairedPercent")) {
                                        var barChartData = self.getAggregatedBarData(aggregatedBarData, "UnrepairedPercent");
                                        charts.createLimitedBarChart()
                                            .initialize("Average percent of unrepaired handpieces by period", barChartData, "{0:p2}", "#= value ? value.toLocaleString('en', {style: 'percent'}) : '' #", 0.5);
                                    }
                                    if (self._reportFields.isToggled("CostSum")) {
                                        var barChartData = self.getAggregatedBarData(aggregatedBarData, "CostSum");
                                        charts.createBarChart()
                                            .initialize("Sum of handpieces repair cost by period", barChartData, "{0:c0}", "#= value ? value.toLocaleString('en-AU', { style: 'currency', currency: 'AUD', minimumFractionDigits: 0, maximumFractionDigits: 0 }) : '' #", undefined);
                                    }
                                    if (self._reportFields.isToggled("CostAverage")) {
                                        var barChartData = self.getAggregatedBarData(aggregatedBarData, "CostAverage");
                                        charts.createBarChart()
                                            .initialize("Average of handpieces repair cost by period", barChartData, "{0:c0}", "#= value ? value.toLocaleString('en-AU', { style: 'currency', currency: 'AUD', minimumFractionDigits: 0, maximumFractionDigits: 0 }) : '' #", undefined);
                                    }
                                    if (self._reportFields.isToggled("HandpiecesCount")) {
                                        var barChartData = self.getAggregatedBarData(aggregatedBarData, "HandpiecesCount");
                                        charts.createBarChart()
                                            .initialize("Sum of handpieces repaired by period", (barChartData), "{0:n0}", "#= value ? value : '' #", undefined);
                                    }
                                }
                                function renderEntirePeriodCharts() {
                                    self._insightsContainer.append(chartsWrapper);
                                    {
                                        var pieChartData = self.getHandpieceNumberPieChartData();
                                        charts.createPieChart()
                                            .initialize("Brands by number of handpieces received", pieChartData, "{0:n0}", "#= category #: \n #= value #", undefined);
                                    }
                                    {
                                        var pieChartData = self.getHandpieceCostPieChartData();
                                        charts.createPieChart()
                                            .initialize("Brands by cost of handpieces repaired", pieChartData, "{0:c0}", "#= category #: \n #= value.toLocaleString('en-AU', { style: 'currency', currency: 'AUD', minimumFractionDigits: 0, maximumFractionDigits: 0 }) #", undefined);
                                    }
                                    {
                                        var mapChartData = self.calculateBrandsChartData();
                                        charts.createTreeMap()
                                            .initialize("Brands map by cost of repairs", mapChartData, "{0:c0}", undefined, undefined);
                                    }
                                }
                                var totalsWrapper, chartsWrapper, charts, self, data, totalCount, totalRating, totalUnrepaired, totalCost, i, item, i, item, key;
                                return __generator(this, function (_a) {
                                    this._insightsContainer.empty();
                                    if (!this._insightsToggle.active) {
                                        return [2 /*return*/];
                                    }
                                    totalsWrapper = $("<div></div>").addClass("row");
                                    chartsWrapper = $("<div></div>").addClass("row");
                                    charts = new Reports.ChartsCollectionContainer(chartsWrapper);
                                    self = this;
                                    data = this._dataSource.data();
                                    if (data.length === 0) {
                                        renderNoRecords();
                                        return [2 /*return*/];
                                    }
                                    totalCount = 0;
                                    totalRating = 0;
                                    totalUnrepaired = 0;
                                    totalCost = 0;
                                    if (this._dateAggregate.value() === "EntirePeriod") {
                                        for (i = 0; i < data.length; i++) {
                                            item = data[i];
                                            if (item.HandpiecesCount !== undefined && typeof item.HandpiecesCount === "number") {
                                                totalCount += item.HandpiecesCount;
                                                if (item.CostSum !== undefined && typeof item.CostSum === "number") {
                                                    totalCost += item.CostSum;
                                                }
                                                if (item.RatingAverage !== undefined && typeof item.RatingAverage === "number") {
                                                    totalRating += item.RatingAverage * item.HandpiecesCount;
                                                }
                                                if (item.UnrepairedPercent !== undefined && typeof item.UnrepairedPercent === "number") {
                                                    totalUnrepaired += item.UnrepairedPercent * item.HandpiecesCount;
                                                }
                                            }
                                        }
                                        renderFlatValueInsights(totalCount, totalRating, totalUnrepaired, totalCost);
                                        renderEntirePeriodCharts();
                                    }
                                    else {
                                        for (i = 0; i < data.length; i++) {
                                            item = data[i];
                                            if (item.HandpiecesCount !== undefined && typeof item.HandpiecesCount === "object") {
                                                for (key in item.HandpiecesCount) {
                                                    if (item.HandpiecesCount.hasOwnProperty(key) && typeof item.HandpiecesCount[key] === "number") {
                                                        totalCount += item.HandpiecesCount[key];
                                                        if (item.CostSum !== undefined && item.CostSum.hasOwnProperty(key) && typeof item.CostSum[key] === "number") {
                                                            totalCost += item.CostSum[key];
                                                        }
                                                        if (item.RatingAverage !== undefined &&
                                                            item.RatingAverage.hasOwnProperty(key) &&
                                                            typeof item.RatingAverage[key] === "number") {
                                                            totalRating += item.RatingAverage[key] * item.HandpiecesCount[key];
                                                        }
                                                        if (item.UnrepairedPercent !== undefined &&
                                                            item.UnrepairedPercent.hasOwnProperty(key) &&
                                                            typeof item.UnrepairedPercent[key] === "number") {
                                                            totalUnrepaired += item.UnrepairedPercent[key] * item.HandpiecesCount[key];
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        renderFlatValueInsights(totalCount, totalRating, totalUnrepaired, totalCost);
                                        renderAggregatedCharts();
                                    }
                                    return [2 /*return*/];
                                });
                            });
                        };
                        ReportsTabBrands.prototype.getAggregatedBarData = function (data, reportFieldName) {
                            var response = new Array();
                            for (var i in data.series[reportFieldName].data) {
                                response.push({
                                    name: data.series[reportFieldName].data[i].name,
                                    value: data.series[reportFieldName].data[i].values,
                                });
                            }
                            return response;
                        };
                        ReportsTabBrands.prototype.getHandpieceCostPieChartData = function () {
                            var response = new Array();
                            var data = this.calculateHandpiecesChartData();
                            for (var i in data) {
                                response.push({
                                    category: data[i].Brand,
                                    value: data[i].TotalCost
                                });
                            }
                            return response;
                        };
                        ReportsTabBrands.prototype.getHandpieceNumberPieChartData = function () {
                            var response = new Array();
                            var data = this.calculateHandpiecesChartData();
                            for (var i in data) {
                                response.push({
                                    category: data[i].Brand,
                                    value: data[i].TotalNumber
                                });
                            }
                            return response;
                        };
                        ReportsTabBrands.prototype.calculateAggregatedChartData = function () {
                            var response = {
                                series: {
                                    AverageRating: {
                                        name: "Average Rating",
                                        data: []
                                    },
                                    UnrepairedPercent: {
                                        name: "Unrepaired Percent",
                                        data: []
                                    },
                                    CostSum: {
                                        name: "Cost Sum",
                                        data: []
                                    },
                                    CostAverage: {
                                        name: "Cost Average",
                                        data: []
                                    },
                                    HandpiecesCount: {
                                        name: "Handpieces Count",
                                        data: []
                                    }
                                },
                            };
                            var data = this._dataSourceModels.data();
                            var dateAggregate = this._dateAggregate.value();
                            var dateRanges = this.generateDateRange(this._filterDateFrom, this._filterDateTo, dateAggregate);
                            var _loop_6 = function (range) {
                                var handpiecesCount = data.reduce(function (x, hbs) { return x + hbs["HandpiecesCount_" + range.replace("-", "_")]; }, 0);
                                response.series['HandpiecesCount'].data.push({
                                    name: range,
                                    values: handpiecesCount
                                });
                                var averageRating = data.reduce(function (x, hbs) { return x + hbs["RatingAverage_" + range.replace("-", "_")] * hbs["HandpiecesCount_" + range.replace("-", "_")]; }, 0) /
                                    handpiecesCount;
                                response.series['AverageRating'].data.push({
                                    name: range,
                                    values: averageRating
                                });
                                var unrepairedPercent = data.reduce(function (x, hbs) { return x +
                                    hbs["UnrepairedPercent_" + range.replace("-", "_")] * hbs["HandpiecesCount_" + range.replace("-", "_")]; }, 0) /
                                    handpiecesCount;
                                response.series['UnrepairedPercent'].data.push({
                                    name: range,
                                    values: unrepairedPercent
                                });
                                var costSum = data.reduce(function (x, hbs) { return x + hbs["CostSum_" + range.replace("-", "_")]; }, 0);
                                response.series['CostSum'].data.push({
                                    name: range,
                                    values: costSum
                                });
                                var costAverage = costSum / handpiecesCount;
                                response.series['CostAverage'].data.push({
                                    name: range,
                                    values: costAverage
                                });
                            };
                            for (var _i = 0, dateRanges_9 = dateRanges; _i < dateRanges_9.length; _i++) {
                                var range = dateRanges_9[_i];
                                _loop_6(range);
                            }
                            return response;
                        };
                        ReportsTabBrands.prototype.calculateBrandsChartData = function () {
                            var response = new Array();
                            var data = this._dataSource.data();
                            var handpiecesBySurgery = data.reduce(function (hbs, d) {
                                var _a;
                                return (__assign(__assign({}, hbs), (_a = {}, _a[d.Brand] = __spreadArray(__spreadArray([], (hbs[d.Brand] || []), true), [d], false), _a)));
                            }, {});
                            var brands = Object.keys(handpiecesBySurgery);
                            for (var _i = 0, brands_1 = brands; _i < brands_1.length; _i++) {
                                var brand = brands_1[_i];
                                var value = handpiecesBySurgery[brand].reduce(function (x, hbs) { return x + hbs.CostSum; }, 0);
                                response.push({
                                    name: brand + " &#10; " + value.toLocaleString("en-AU", { style: 'currency', currency: 'AUD', minimumFractionDigits: 0, maximumFractionDigits: 0 }),
                                    value: value
                                });
                            }
                            return response;
                        };
                        ReportsTabBrands.prototype.calculateHandpiecesChartData = function () {
                            var response = new Array();
                            var data = this._dataSource.data();
                            var handpiecesByBrand = data.reduce(function (hbb, d) {
                                var _a;
                                return (__assign(__assign({}, hbb), (_a = {}, _a[d.Brand] = __spreadArray(__spreadArray([], (hbb[d.Brand] || []), true), [d], false), _a)));
                            }, {});
                            var brands = Object.keys(handpiecesByBrand);
                            for (var i in brands) {
                                response.push({
                                    Brand: brands[i],
                                    TotalNumber: handpiecesByBrand[brands[i]].reduce(function (x, hbb) { return x + hbb.HandpiecesCount; }, 0),
                                    TotalCost: handpiecesByBrand[brands[i]].reduce(function (x, hbb) { return x + hbb.CostSum; }, 0)
                                });
                            }
                            return response;
                        };
                        return ReportsTabBrands;
                    }(Reports.ReportsTabBase));
                    Reports.ReportsTabBrands = ReportsTabBrands;
                })(Reports = Surgeries.Reports || (Surgeries.Reports = {}));
            })(Surgeries = Pages.Surgeries || (Pages.Surgeries = {}));
        })(Pages = CRM.Pages || (CRM.Pages = {}));
    })(CRM = DentalDrill.CRM || (DentalDrill.CRM = {}));
})(DentalDrill || (DentalDrill = {}));
//# sourceMappingURL=ReportsTabBrands.js.map
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var DentalDrill;
(function (DentalDrill) {
    var CRM;
    (function (CRM) {
        var Pages;
        (function (Pages) {
            var Surgeries;
            (function (Surgeries) {
                var Reports;
                (function (Reports) {
                    var ToggleButton = DentalDrill.CRM.Controls.ToggleButton;
                    var PdfReportBuilder = DentalDrill.CRM.Controls.PdfReports.PdfReportBuilder;
                    var ReportTable = DentalDrill.CRM.Controls.Reporting.ReportTable;
                    var SurgeryReportFlowWriter = DentalDrill.CRM.Controls.Reporting.SurgeryReportFlowWriter;
                    var ReportsTabStatuses = /** @class */ (function (_super) {
                        __extends(ReportsTabStatuses, _super);
                        function ReportsTabStatuses(page, root) {
                            var _this = _super.call(this) || this;
                            _this._page = page;
                            _this._root = root;
                            _this._container = root.find(".reports__statuses__container");
                            _this._insightsContainer = root.find(".reports__statuses__insights-container");
                            _this._insightsToggle = new ToggleButton(root.find(".reports__statuses__insights"));
                            _this._insightsToggle.changed.subscribe(function (sender, e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.toggleInsights()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            root.find(".reports__statuses__export__excel").click(function (e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.exportExcel()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            root.find(".reports__statuses__export__pdf").click(function (e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.exportPdf()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            return _this;
                        }
                        ReportsTabStatuses.prototype.exportExcel = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    routes.surgeries.exportStatusesToExcel(this._page.clientUrlPath, this._filterDateFrom, this._filterDateTo).open();
                                    return [2 /*return*/];
                                });
                            });
                        };
                        ReportsTabStatuses.prototype.exportPdf = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                var formatAsNumber, reportBuilder, reportWriter, children, table;
                                return __generator(this, function (_a) {
                                    formatAsNumber = function (x, decimalDigits) {
                                        if (typeof x === "number") {
                                            return x.toFixed(decimalDigits);
                                        }
                                        return "";
                                    };
                                    reportBuilder = new PdfReportBuilder();
                                    reportBuilder.fileName = this._page.clientUrlPath + "-ByStatus.pdf";
                                    reportBuilder.open();
                                    reportWriter = new SurgeryReportFlowWriter(reportBuilder);
                                    reportWriter.addHeading(1, "Handpieces by status");
                                    if (this._insightsToggle.active) {
                                        children = this._insightsContainer.children();
                                        reportWriter.addInsightsTotals("Total Handpieces by statuses", $(children[0]));
                                        reportWriter.addCharts($(children[2]).find(".k-chart").toArray().map(function (element, index) { return $(element).data("kendoChart"); }));
                                        reportWriter.addInsightsTotals("Average Handpieces by statuses", $(children[3]));
                                        reportWriter.nextPage();
                                    }
                                    table = new ReportTable();
                                    table.rowHeight = 23;
                                    table.addColumn("Brand", 120, function (x) { return x.Brand; });
                                    table.addColumn("Received", 50, function (x) { return formatAsNumber(x.StatusReceived, 0); });
                                    table.addColumn("Being Est.", 50, function (x) { return formatAsNumber(x.StatusBeingEstimated, 0); });
                                    table.addColumn("Waiting App.", 50, function (x) { return formatAsNumber(x.StatusWaitingForApproval, 0); });
                                    table.addColumn("Est. Sent", 50, function (x) { return formatAsNumber(x.StatusEstimateSent, 0); });
                                    table.addColumn("Being Rep.", 50, function (x) { return formatAsNumber(x.StatusBeingRepaired, 0); });
                                    table.addColumn("Rdy. For Ret.", 50, function (x) { return formatAsNumber(x.StatusReadyToReturn, 0); });
                                    table.addColumn("Unrepaired", 50, function (x) { return formatAsNumber(x.StatusCancelled, 0); });
                                    table.addColumn("Complete", 50, function (x) { return formatAsNumber(x.StatusSentComplete, 0); });
                                    table.setData(this._dataSource.data().map(function (x) { return x; }), function (left, right) {
                                        if (left.Brand < right.Brand)
                                            return -1;
                                        if (left.Brand > right.Brand)
                                            return 1;
                                        return 0;
                                    });
                                    reportWriter.addTable(table);
                                    return [2 /*return*/];
                                });
                            });
                        };
                        ReportsTabStatuses.prototype.initializeDataSourceFields = function (fields) {
                            var baseFields = [
                                "StatusReceived", "StatusBeingEstimated", "StatusWaitingForApproval",
                                "StatusEstimateSent", "StatusBeingRepaired", "StatusReadyToReturn",
                                "StatusSentComplete", "StatusCancelled", "StatusAny"
                            ];
                            for (var _i = 0, baseFields_1 = baseFields; _i < baseFields_1.length; _i++) {
                                var field = baseFields_1[_i];
                                fields[field] = { type: "number", from: field };
                            }
                            return fields;
                        };
                        ReportsTabStatuses.prototype.initializeDataSources = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0:
                                            this._dataSource = new kendo.data.DataSource({
                                                type: "aspnetmvc-ajax",
                                                transport: {
                                                    read: {
                                                        url: "/Surgeries/" + this._page.clientUrlPath + "/Reports/Statuses",
                                                        data: {
                                                            From: this._filterDateFrom.toISOString(),
                                                            To: this._filterDateTo.toISOString()
                                                        }
                                                    }
                                                },
                                                schema: {
                                                    data: "Data",
                                                    total: "Total",
                                                    errors: "Errors",
                                                    model: {
                                                        fields: this.initializeDataSourceFields({
                                                            Brand: { type: "string" }
                                                        })
                                                    }
                                                }
                                            });
                                            return [4 /*yield*/, this._dataSource.read()];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            });
                        };
                        ReportsTabStatuses.prototype.getFieldsCandidates = function () {
                            return [
                                {
                                    field: "StatusReceived",
                                    title: "Received",
                                    format: "{0:n0}"
                                },
                                {
                                    field: "StatusBeingEstimated",
                                    title: "Being Est.",
                                    format: "{0:n0}"
                                },
                                {
                                    field: "StatusWaitingForApproval",
                                    title: "Waiting App.",
                                    format: "{0:n0}"
                                },
                                {
                                    field: "StatusEstimateSent",
                                    title: "Est. Sent",
                                    format: "{0:n0}"
                                },
                                {
                                    field: "StatusBeingRepaired",
                                    title: "Being Rep.",
                                    format: "{0:n0}"
                                },
                                {
                                    field: "StatusReadyToReturn",
                                    title: "Rdy. For Ret.",
                                    format: "{0:n0}"
                                },
                                {
                                    field: "StatusCancelled",
                                    title: "Unrepaired",
                                    format: "{0:n0}"
                                },
                                {
                                    field: "StatusSentComplete",
                                    title: "Complete",
                                    format: "{0:n0}"
                                }
                            ];
                        };
                        ReportsTabStatuses.prototype.createMainGrid = function () {
                            var wrapper = $("<div></div>");
                            this._container.empty();
                            this._container.append(wrapper);
                            var columnsConfig = [];
                            columnsConfig.push({
                                field: "Brand",
                                title: "Brand",
                                width: "300px"
                            });
                            var fieldsCandidates = this.getFieldsCandidates();
                            for (var _i = 0, fieldsCandidates_1 = fieldsCandidates; _i < fieldsCandidates_1.length; _i++) {
                                var candidate = fieldsCandidates_1[_i];
                                columnsConfig.push({
                                    field: candidate.field,
                                    title: candidate.title,
                                    width: "90px",
                                    format: candidate.format,
                                });
                            }
                            columnsConfig.push({
                                title: ""
                            });
                            wrapper.kendoGrid({
                                dataSource: this._dataSource,
                                columns: columnsConfig,
                                scrollable: true,
                                sortable: {
                                    mode: "multiple",
                                    allowUnsort: true,
                                },
                                noRecords: {
                                    template: "No data available for selected date range and surgeries"
                                }
                            });
                        };
                        ReportsTabStatuses.prototype.initialize = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.initializeDataSources()];
                                        case 1:
                                            _a.sent();
                                            this.createMainGrid();
                                            return [4 /*yield*/, this.toggleInsights()];
                                        case 2:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            });
                        };
                        ReportsTabStatuses.prototype.applyGlobalFilters = function (from, to) {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    this._filterDateFrom = from;
                                    this._filterDateTo = to;
                                    return [2 /*return*/];
                                });
                            });
                        };
                        ReportsTabStatuses.prototype.toggleInsights = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                var data, charts, totalsSum, totalsAvg, self, aggregate, i, item, sumChartData, averageChartData;
                                return __generator(this, function (_a) {
                                    this._insightsContainer.empty();
                                    if (!this._insightsToggle.active) {
                                        return [2 /*return*/];
                                    }
                                    data = this._dataSource.data();
                                    if (data.length === 0) {
                                        this._insightsContainer.append($("<div></div>").addClass("row").append($("<div></div>")
                                            .addClass("reports__insights__total__value")
                                            .addClass("col-12")
                                            .text("No data available for selected date range and surgeries")));
                                        return [2 /*return*/];
                                    }
                                    charts = new Reports.ChartsCollectionContainer($("<div></div>").addClass("row"));
                                    totalsSum = new Reports.TotalsCollectionContainer($("<div></div>").addClass("row"));
                                    totalsAvg = new Reports.TotalsCollectionContainer($("<div></div>").addClass("row"));
                                    self = this;
                                    aggregate = {
                                        count: 0,
                                        sum: {
                                            StatusReceived: 0,
                                            StatusBeingEstimated: 0,
                                            StatusWaitingForApproval: 0,
                                            StatusEstimateSent: 0,
                                            StatusBeingRepaired: 0,
                                            StatusReadyToReturn: 0,
                                            StatusSentComplete: 0,
                                            StatusCancelled: 0,
                                            StatusAny: 0
                                        }
                                    };
                                    for (i = 0; i < data.length; i++) {
                                        item = data[i];
                                        aggregate.count++;
                                        aggregate.sum.StatusReceived += item.StatusReceived || 0;
                                        aggregate.sum.StatusBeingEstimated += item.StatusBeingEstimated || 0;
                                        aggregate.sum.StatusWaitingForApproval += item.StatusWaitingForApproval || 0;
                                        aggregate.sum.StatusEstimateSent += item.StatusEstimateSent || 0;
                                        aggregate.sum.StatusBeingRepaired += item.StatusBeingRepaired || 0;
                                        aggregate.sum.StatusReadyToReturn += item.StatusReadyToReturn || 0;
                                        aggregate.sum.StatusSentComplete += item.StatusSentComplete || 0;
                                        aggregate.sum.StatusCancelled += item.StatusCancelled || 0;
                                        aggregate.sum.StatusAny += item.StatusAny || 0;
                                    }
                                    totalsSum.addValue("Received", kendo.format("{0:n0}", aggregate.sum.StatusReceived));
                                    totalsSum.addValue("Being Estimated", kendo.format("{0:n0}", aggregate.sum.StatusBeingEstimated));
                                    totalsSum.addValue("Waiting For App.", kendo.format("{0:n0}", aggregate.sum.StatusWaitingForApproval));
                                    totalsSum.addValue("Estimate Sent", kendo.format("{0:n0}", aggregate.sum.StatusEstimateSent));
                                    totalsSum.addValue("Being Repaired", kendo.format("{0:n0}", aggregate.sum.StatusBeingRepaired));
                                    totalsSum.addValue("Ready to Return", kendo.format("{0:n0}", aggregate.sum.StatusReadyToReturn));
                                    totalsSum.addValue("Unrepaired", kendo.format("{0:n0}", aggregate.sum.StatusCancelled));
                                    totalsSum.addValue("Sent Complete", kendo.format("{0:n0}", aggregate.sum.StatusSentComplete));
                                    totalsAvg.addValue("Received", kendo.format("{0:0.##}", aggregate.sum.StatusReceived / aggregate.count));
                                    totalsAvg.addValue("Being Estimated", kendo.format("{0:0.##}", aggregate.sum.StatusBeingEstimated / aggregate.count));
                                    totalsAvg.addValue("Waiting For App.", kendo.format("{0:0.##}", aggregate.sum.StatusWaitingForApproval / aggregate.count));
                                    totalsAvg.addValue("Estimate Sent", kendo.format("{0:0.##}", aggregate.sum.StatusEstimateSent / aggregate.count));
                                    totalsAvg.addValue("Being Repaired", kendo.format("{0:0.##}", aggregate.sum.StatusBeingRepaired / aggregate.count));
                                    totalsAvg.addValue("Ready to Return", kendo.format("{0:0.##}", aggregate.sum.StatusReadyToReturn / aggregate.count));
                                    totalsAvg.addValue("Unrepaired", kendo.format("{0:0.##}", aggregate.sum.StatusCancelled / aggregate.count));
                                    totalsAvg.addValue("Sent Complete", kendo.format("{0:0.##}", aggregate.sum.StatusSentComplete / aggregate.count));
                                    this._insightsContainer.append(totalsSum.container);
                                    this._insightsContainer.append($("<div></div>").addClass("row").append($("<div></div>").addClass("col-12 text-center font-italic mt-2").text("Total Handpieces by statuses")));
                                    this._insightsContainer.append(charts.container);
                                    this._insightsContainer.append(totalsAvg.container);
                                    this._insightsContainer.append($("<div></div>").addClass("row").append($("<div></div>").addClass("col-12 text-center font-italic mt-2").text("Average Handpieces by statuses")));
                                    sumChartData = [
                                        { name: "Received", value: aggregate.sum.StatusReceived },
                                        { name: "Being Estimated", value: aggregate.sum.StatusBeingEstimated },
                                        { name: "Waiting For App.", value: aggregate.sum.StatusWaitingForApproval },
                                        { name: "Estimate Sent", value: aggregate.sum.StatusEstimateSent },
                                        { name: "Being Repaired", value: aggregate.sum.StatusBeingRepaired },
                                        { name: "Ready to Return", value: aggregate.sum.StatusReadyToReturn },
                                        { name: "Unrepaired", value: aggregate.sum.StatusCancelled },
                                        { name: "Sent Complete", value: aggregate.sum.StatusSentComplete }
                                    ];
                                    charts.createWaterfallChart().initialize("Total Handpieces", sumChartData, "{0:n0}", "#: value #", undefined);
                                    averageChartData = [
                                        { name: "Received", value: aggregate.sum.StatusReceived / aggregate.count },
                                        { name: "Being Estimated", value: aggregate.sum.StatusBeingEstimated / aggregate.count },
                                        { name: "Waiting For App.", value: aggregate.sum.StatusWaitingForApproval / aggregate.count },
                                        { name: "Estimate Sent", value: aggregate.sum.StatusEstimateSent / aggregate.count },
                                        { name: "Being Repaired", value: aggregate.sum.StatusBeingRepaired / aggregate.count },
                                        { name: "Ready to Return", value: aggregate.sum.StatusReadyToReturn / aggregate.count },
                                        { name: "Unrepaired", value: aggregate.sum.StatusCancelled / aggregate.count },
                                        { name: "Sent Complete", value: aggregate.sum.StatusSentComplete / aggregate.count }
                                    ];
                                    charts.createWaterfallChart().initialize("Average Handpieces", averageChartData, "{0:0.##}", "#: kendo.format('{0:0.\\#\\#}', value) #", undefined);
                                    return [2 /*return*/];
                                });
                            });
                        };
                        return ReportsTabStatuses;
                    }(Reports.ReportsTabBase));
                    Reports.ReportsTabStatuses = ReportsTabStatuses;
                })(Reports = Surgeries.Reports || (Surgeries.Reports = {}));
            })(Surgeries = Pages.Surgeries || (Pages.Surgeries = {}));
        })(Pages = CRM.Pages || (CRM.Pages = {}));
    })(CRM = DentalDrill.CRM || (DentalDrill.CRM = {}));
})(DentalDrill || (DentalDrill = {}));
//# sourceMappingURL=ReportsTabStatuses.js.map
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var DentalDrill;
(function (DentalDrill) {
    var CRM;
    (function (CRM) {
        var Pages;
        (function (Pages) {
            var Surgeries;
            (function (Surgeries) {
                var Reports;
                (function (Reports) {
                    var ReportsPage = /** @class */ (function () {
                        function ReportsPage(root) {
                            var _this = this;
                            this._root = root;
                            this._clientId = root.attr("data-client-id");
                            this._clientUrlPath = root.attr("data-client-urlpath");
                            this._mainControls = new Reports.ReportsPageMainControls(root);
                            this._brands = new Reports.ReportsTabBrands(this, root.find(".reports__brands"));
                            this._statuses = new Reports.ReportsTabStatuses(this, root.find(".reports__statuses"));
                            this._mainControls.buttonClear.on("click", function (e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0:
                                            this._mainControls.dateRangeSelector.reset();
                                            return [4 /*yield*/, this._brands.applyGlobalFilters(this._mainControls.dateFrom.value(), this._mainControls.dateTo.value())];
                                        case 1:
                                            _a.sent();
                                            return [4 /*yield*/, this._statuses.applyGlobalFilters(this._mainControls.dateFrom.value(), this._mainControls.dateTo.value())];
                                        case 2:
                                            _a.sent();
                                            return [4 /*yield*/, this._brands.initialize()];
                                        case 3:
                                            _a.sent();
                                            return [4 /*yield*/, this._statuses.initialize()];
                                        case 4:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            this._mainControls.buttonSearch.on("click", function (e) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this._brands.applyGlobalFilters(this._mainControls.dateFrom.value(), this._mainControls.dateTo.value())];
                                        case 1:
                                            _a.sent();
                                            return [4 /*yield*/, this._statuses.applyGlobalFilters(this._mainControls.dateFrom.value(), this._mainControls.dateTo.value())];
                                        case 2:
                                            _a.sent();
                                            return [4 /*yield*/, this._brands.initialize()];
                                        case 3:
                                            _a.sent();
                                            return [4 /*yield*/, this._statuses.initialize()];
                                        case 4:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); });
                            root.data("ReportsPage", this);
                            console.log("ReportsPage constructed");
                        }
                        Object.defineProperty(ReportsPage.prototype, "clientId", {
                            get: function () {
                                return this._clientId;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        Object.defineProperty(ReportsPage.prototype, "clientUrlPath", {
                            get: function () {
                                return this._clientUrlPath;
                            },
                            enumerable: false,
                            configurable: true
                        });
                        ReportsPage.prototype.initialize = function () {
                            return __awaiter(this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this._brands.applyGlobalFilters(this._mainControls.dateFrom.value(), this._mainControls.dateTo.value())];
                                        case 1:
                                            _a.sent();
                                            return [4 /*yield*/, this._statuses.applyGlobalFilters(this._mainControls.dateFrom.value(), this._mainControls.dateTo.value())];
                                        case 2:
                                            _a.sent();
                                            return [4 /*yield*/, this._brands.initialize()];
                                        case 3:
                                            _a.sent();
                                            return [4 /*yield*/, this._statuses.initialize()];
                                        case 4:
                                            _a.sent();
                                            this.setValidation();
                                            console.log("ReportsPage initialized");
                                            return [2 /*return*/];
                                    }
                                });
                            });
                        };
                        ReportsPage.prototype.setValidation = function () {
                            var containerFrom = $("#FilterDateFrom");
                            containerFrom.kendoValidator({
                                rules: {
                                    isValidDate: function (input) {
                                        if (kendo.parseDate(input.val()) === null) {
                                            return false;
                                        }
                                        else {
                                            return true;
                                        }
                                    }
                                },
                                messages: {
                                    isValidDate: "Invalid date format"
                                }
                            });
                            var containerTo = $("#FilterDateTo");
                            containerTo.kendoValidator({
                                rules: {
                                    isValidDate: function (input) {
                                        if (kendo.parseDate(input.val()) === null) {
                                            return false;
                                        }
                                        else {
                                            return true;
                                        }
                                    }
                                },
                                messages: {
                                    isValidDate: "Invalid date format"
                                }
                            });
                        };
                        return ReportsPage;
                    }());
                    Reports.ReportsPage = ReportsPage;
                })(Reports = Surgeries.Reports || (Surgeries.Reports = {}));
            })(Surgeries = Pages.Surgeries || (Pages.Surgeries = {}));
        })(Pages = CRM.Pages || (CRM.Pages = {}));
    })(CRM = DentalDrill.CRM || (DentalDrill.CRM = {}));
})(DentalDrill || (DentalDrill = {}));
//# sourceMappingURL=ReportsPage.js.map